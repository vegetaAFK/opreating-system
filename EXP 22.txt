#include <stdio.h>
#include <fcntl.h>
#include <unistd.h>
#include <string.h>
#include <stdlib.h>

int main() {
    int choice, fd;
    char filename[50], buffer[100];
    ssize_t bytes;

    while (1) {
        printf("\n--- UNIX I/O File Management ---\n");
        printf("1. Create File\n");
        printf("2. Write File\n");
        printf("3. Read File\n");
        printf("4. Delete File\n");
        printf("5. Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);
        getchar(); // consume newline

        switch (choice) {
        case 1:
            printf("Enter file name to create: ");
            scanf("%s", filename);
            fd = open(filename, O_CREAT | O_EXCL | O_RDWR, 0644);
            if (fd == -1) {
                perror("Error creating file");
            } else {
                printf("File created successfully.\n");
                close(fd);
            }
            break;

        case 2:
            printf("Enter file name to write: ");
            scanf("%s", filename);
            fd = open(filename, O_WRONLY);
            if (fd == -1) {
                perror("File not found");
                break;
            }
            printf("Enter data to write: ");
            getchar(); // consume newline
            fgets(buffer, sizeof(buffer), stdin);
            buffer[strcspn(buffer, "\n")] = 0; // remove newline
            bytes = write(fd, buffer, strlen(buffer));
            if (bytes == -1) perror("Write error");
            else printf("Data written successfully.\n");
            close(fd);
            break;

        case 3:
            printf("Enter file name to read: ");
            scanf("%s", filename);
            fd = open(filename, O_RDONLY);
            if (fd == -1) {
                perror("File not found");
                break;
            }
            bytes = read(fd, buffer, sizeof(buffer)-1);
            if (bytes == -1) perror("Read error");
            else {
                buffer[bytes] = '\0';
                printf("Data read: %s\n", buffer);
            }
            close(fd);
            break;

        case 4:
            printf("Enter file name to delete: ");
            scanf("%s", filename);
            if (unlink(filename) == -1)
                perror("Error deleting file");
            else
                printf("File deleted successfully.\n");
            break;

        case 5:
            printf("Exiting...\n");
            exit(0);

        default:
            printf("Invalid choice!\n");
        }
    }
}
